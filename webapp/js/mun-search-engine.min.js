var SearchEngine={top10ByMunChartReference:null,stateChartReference:null,munGroup:null,modalContent:null,msf_ui:[],msf:[],msf_pm:[],msf_all:[],enableCtl:!1,init:function(a,b,c){this.modalContent=c,this.top10ByMunChartReference=a,this.stateChartReference=b,this.munGroup=this.top10ByMunChartReference.group().all(),this.rebuildModalWindow()},rebuildModalWindow:function(){var a='<div class="modal fade" id="modal-container-filtered"><div class="modal-dialog logo-card"><div class="modal-content modalinf"><div class="modal-header fechar"><h5 class="modal-title boxtitletable"><span>'+Translation[Lang.language].txt1f+'</span></h5>'+'<button type="button" class="close" data-dismiss="modal" aria-hidden="true"><i class="material-icons">clear</i></button>'+'</div>'+'<div class="modal-body">'+'<span class="txtgreen">'+Translation[Lang.language].txt1tg+'</span>'+'<input type="checkbox" id="btnPriorityMun" onclick="SearchEngine.showContextMuns()"><br/>'+'<div class="input-group input-group-sm search-form">'+'<input autofocus id="search-county" onkeypress="SearchEngine.searchCountyByEnterKey(event)" type="text" class="form-control" placeholder="'+Translation[Lang.language].txt1g+'">'+'<label>'+'<button class="btn btngreen btnsearch" onclick="SearchEngine.search()"><i class="material-icons">search</i></button>'+'</label>'+'</div>'+'<div id="selectool" style="display:none;">'+'<input type="checkbox" id="btnSelectool" onclick="SearchEngine.enableDisableAll()">'+'<span class="txtgreen"> '+Translation[Lang.language].txt1h+'</span>'+'</div>'+'<div class="counties-list"><ul id="filtered-list"></ul></div>'+'<div id="missing_area" style="display:none;">'+'<br/><span style="color: red;">*</span>'+'<span class="disable-li"> '+Translation[Lang.language].txt1w+'</span>'+'</div>'+'</div>'+'<div class="modal-footer">'+'<div class="checkbox pull-right">'+'<label>'+'<button type="button" class="btn btngreen" onclick="SearchEngine.selectPriorityMuns();">'+'<span>'+Translation[Lang.language].txt1p+'</span>'+'</button>'+'</label>'+'&nbsp;'+'<label>'+'<button type="button" class="btn btngreen" data-dismiss="modal">'+'<span>'+Translation[Lang.language].txt1i+'</span>'+'</button>'+'</label>'+'</div>'+'</div>'+'</div>'+'</div>'+'</div>';$('#'+SearchEngine.modalContent).html(a)},enableDisableAll:function(){SearchEngine.enableCtl=!SearchEngine.enableCtl;let a=$('#filtered-list li');a.length&&a.each((b,a)=>{a.className=SearchEngine.enableCtl?'enable-li':''}),SearchEngine.msf=[],SearchEngine.enableCtl&&SearchEngine.msf_ui.length&&SearchEngine.msf_ui.forEach(a=>{SearchEngine.msf.push(a.key)})},enableDisableItem:function(b){let a=$('#idmun_'+b);if(!a.length)return;if(a=a[0],a.className=a.className==''?'enable-li':'',a.className==''){if(SearchEngine.msf.length){let a=SearchEngine.msf.findIndex(a=>a==SearchEngine.msf_ui[b].key);SearchEngine.msf.splice(a,1)}}else SearchEngine.msf.push(SearchEngine.msf_ui[b].key)},searchCountyByEnterKey:function(a){return a.keyCode==13&&SearchEngine.search(),a},preSearchFromPriority:function(a,b=!0){let c=a.features[0].properties.codes.split(',');if(SearchEngine.msf_pm.length)SearchEngine.msf_ui=SearchEngine.msf_pm;else{let a=this.munGroup;this.msf_ui=[],c.forEach(function(c){let b=graph.dimensions.codibge.filterFunction(function(a){return a.codibge==c});if(b.top(1).length){let d=b.top(1),c=a.find(a=>a.key.toLowerCase()==(d[0].county+"/"+d[0].uf).toLowerCase());typeof c!='undefined'&&SearchEngine.msf_ui.push({key:c.key,value:c.value})}}),SearchEngine.msf_ui.sort((a,b)=>a.key.toLowerCase()>b.key.toLowerCase()?1:-1),SearchEngine.msf_pm=SearchEngine.msf_ui,graph.dimensions.codibge.filterAll()}SearchEngine.msf_all=SearchEngine.msf_pm,b==!0&&this.showFilteredItems()},search:function(){var a=SearchEngine.findInArray(SearchEngine.msf_all,$('#search-county')[0].value);a.length>0?this.msf_ui=a:this.msf_ui=[],this.showFilteredItems()},showFilteredItems:function(){$('#missing_area').hide(),this.msf_ui.length==0?$('#selectool').hide():$('#selectool').show(),document.getElementById("filtered-list").innerHTML=this.msf_ui.length==0?Translation[Lang.language].without:"",this.msf_ui.forEach(function(a,b){var c=a.key.replace("'","Â´");let d=SearchEngine.msf.includes(a.key)?'enable-li':'';a.value?document.getElementById("filtered-list").innerHTML+="<li id='idmun_"+b+"' class='"+d+"'><a href=\"javascript:SearchEngine.enableDisableItem('"+b+"');\">"+c+"</a></li>":($('#missing_area').show(),document.getElementById("filtered-list").innerHTML+="<li id='idmun_"+b+"' class='disable-li'>"+c+" <span style='color: red;'>*</span></li>")}),$('#modal-container-filtered').modal('show')},findInArray:function(b,a){a=a.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,"");var c=$.grep(b,function(b,c){return b.key.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,"").indexOf(a)>=0});return c},findUsingStates:function(b,c){var a=[];return c.forEach(c=>{a=a.concat($.grep(b,function(a,b){return a.key.split('/')[1]===c}))}),a},applyCountyFilter:function(a,b){b=typeof b=='undefined'?!1:!0,!b&&(!a||!a.length)?(this.top10ByMunChartReference.data(function(a){var b=[];return b.push({key:Translation[Lang.language].no_value,value:0}),a.all().length>0?a.top(10):b}),this.top10ByMunChartReference.filterAll(),this.msf=[]):(this.top10ByMunChartReference.data(function(k){var c=[],h,f=k.top(1/0),e,i,g,d;let j=b?a[0][a[0].length-1]:a[a.length-1].key;for(f.findIndex(function(a,b){a.key==j&&(h=b,c.push({key:a.key,value:a.value}))}),e=1,i=[],g=[];e<=5;)d=f[h+e],d&&g.push({key:d.key,value:d.value}),d=f[h-e],d&&i.push({key:d.key,value:d.value}),++e;return c=c.concat(i),g.reverse(),c=g.concat(c),c.reverse(),c}),b?(this.top10ByMunChartReference.filterAll(),SearchEngine.top10ByMunChartReference.filter(a)):this.top10ByMunChartReference.filter(a[a.length-1].key)),dc.redrawAll()},loadPriorityMunicipalityList:function(b=null,c=!0){let a=sessionStorage.getItem("priorityMunData");if(a)a=JSON.parse(a),SearchEngine.preSearchFromPriority(a,c),b&&b(a);else{let a=downloadCtrl.getTerraBrasilisHref()+"/geoserver/prodes-brasil-nb/ows?OUTPUTFORMAT=application/json&SERVICE=WFS&REQUEST=GetFeature&VERSION=2.0.0&exceptions=text/xml&srsName=EPSG:4326&TYPENAME=prodes-brasil-nb:priority_municipalities",d=function(d,a){d?(console.log(d.status),document.getElementById("filtered-list").innerHTML="<li><span>"+Translation[Lang.language].without+"</span></li>"):(sessionStorage.setItem("priorityMunData",JSON.stringify(a)),SearchEngine.preSearchFromPriority(a,c),b&&b(a))};d3.json(a,d)}},showAllMunicipalityList:function(){document.getElementById("filtered-list").innerHTML="";let a=this.munGroup;this.msf_ui=[],a.forEach(a=>{SearchEngine.msf_ui.push({key:a.key,value:a.value})}),SearchEngine.msf_all=SearchEngine.msf_ui,this.showFilteredItems()},selectPriorityMuns:function(){SearchEngine.msf.length?(SearchEngine.applyCountyFilter([SearchEngine.msf],!0),$('#modal-container-filtered').modal('hide')):SearchEngine.applyCountyFilter()},setPriorityMode:function(){$('#btnPriorityMun')[0].checked=!0,this.loadPriorityMunicipalityList(function(a){console.log(a),SearchEngine.msf_pm&&(SearchEngine.msf=[],SearchEngine.msf_pm.forEach(a=>{SearchEngine.msf.push(a.key)}),SearchEngine.applyCountyFilter([SearchEngine.msf],!0))},!1)},showContextMuns:function(){$('#search-county')[0].value="",$('#btnPriorityMun')[0].checked?this.loadPriorityMunicipalityList():this.showAllMunicipalityList()},updateSelectedList:function(){if(SearchEngine.top10ByMunChartReference.hasFilter()){let a=SearchEngine.top10ByMunChartReference.filters();a.length&&a.forEach(a=>{SearchEngine.msf.includes(a)||SearchEngine.msf.push(a)}),SearchEngine.msf.length&&SearchEngine.msf.forEach((b,c)=>{a.includes(b)||SearchEngine.msf.splice(c,1)})}else SearchEngine.msf=[]}}